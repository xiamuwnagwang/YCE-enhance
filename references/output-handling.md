# 输出处理规范

## 成功时

stdout 输出使用 XML 标签格式（LLM 解析准确率最高）：

```xml
<enhanced>
推荐技能：
- <用户本地-skill-名称-1>：<结合当前任务的推荐理由>
- <用户本地-skill-名称-2>：<结合当前任务的推荐理由>

增强提示词正文：
...
</enhanced>
```

标签说明：
- `<enhanced>`: 增强后的结果（包含“推荐技能”小节 + “增强提示词正文”）
- “推荐技能”中的工具名称必须来自用户本机扫描到的 `installed_skills.name`

### 推荐技能说明

每条推荐包含两个关键信息：

| 要素 | 作用 | 示例 |
|------|------|------|
| **工具名** | 标识可调用的本地 skill | `<用户本地-skill-名称>` |
| **推荐理由** | 说明该工具为何适合当前任务 | `定位项目中登录逻辑实现` |

这种结构让 AI 能够：
1. **基于本机环境推荐**：不会写死特定人的 skill 名称
2. **快速判断是否调用**：理由直接对应当前任务
3. **保持输出统一**：推荐与增强正文都在 `<enhanced>` 中

处理步骤：
1. 读取 `<enhanced>` 标签内容
2. 从开头“推荐技能”小节提取推荐工具与理由
3. 使用“增强提示词正文”继续处理用户请求

## 失败时（exit code 非 0）

直接使用用户原始提示词回答，不要报错或中断对话。

## 常见失败原因

- 后端服务未启动
- 网络不可达
- 兑换码无效或已过期
